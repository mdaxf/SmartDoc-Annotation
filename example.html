
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartDoc Library - Integration Demo</title>
    
    <!-- 1. Load Local Styles (Generated by build) -->
    <link rel="stylesheet" href="./distribute/style.css">

    <style>
        body { background-color: #f3f4f6; font-family: sans-serif; }
        
        /* 
           Target the specific ID used by the library.
           Ideally, give the container a specific height so inner scrolling works.
        */
        #smart-doc-root {
            height: 85vh; /* Fixed height is crucial for internal scrolling */
            width: 100%;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            overflow: hidden; /* Ensure library UI stays within bounds */
            background: white;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .log-panel {
            font-family: monospace;
            font-size: 12px;
            height: 150px;
            overflow-y: auto;
            background: #1f2937;
            color: #10b981;
            padding: 10px;
            border-radius: 8px;
            margin-top: 20px;
        }
        /* Overlay for "Build Required" message */
        #build-warning {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.85);
            color: white;
            z-index: 9999;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        .code-block {
            background: #111;
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: monospace;
            margin-top: 1rem;
            border: 1px solid #333;
        }
    </style>

    <!-- 2. The SmartDoc Library Bundle -->
    <!-- 
       NOTE: This file includes React, ReactDOM, and the library code.
       It is generated by running `npm run build`.
    -->
    <script src="./distribute/smart-doc.bundle.js"></script>
    
</head>
<body class="p-8">

    <div id="build-warning">
        <h2 style="font-size: 2rem; margin-bottom: 0.5rem;">Library Not Built</h2>
        <p>The <code>smart-doc.bundle.js</code> file has not been generated yet or failed to load.</p>
        <div class="code-block">
            1. Open Terminal<br>
            2. Run: <code>npm run build</code><br>
            3. Refresh this page
        </div>
        <p style="margin-top: 2rem; opacity: 0.7; font-size: 0.9rem;">
            Note: For the best experience, run this file via a local server (<code>npx serve .</code>) rather than <code>file://</code>
        </p>
    </div>

    <div class="max-w-7xl mx-auto" style="max-width: 1200px; margin: 0 auto;">
        <div style="margin-bottom: 1.5rem;">
            <h1 style="font-size: 1.875rem; font-weight: bold; color: #1f2937;">SmartDoc Integration Demo</h1>
            <p style="color: #4b5563;">This page demonstrates how to embed the SmartDoc library into a legacy application using a single script tag.</p>
        </div>

        <!-- Container for the SmartDoc App -->
        <!-- Fixed: Removed duplicate ID attribute that was breaking CSS targeting -->
        <div id="smart-doc-root"></div>

        <!-- Event Logging Console -->
        <div style="margin-top: 1rem;">
            <h3 style="font-weight: bold; color: #374151; margin-bottom: 0.5rem;">Host Application Event Log:</h3>
            <div id="event-log" class="log-panel">
                <div>> System ready...</div>
            </div>
        </div>
    </div>

    <script>
        // Helper to log events to the HTML UI
        function logEvent(message, data) {
            const log = document.getElementById('event-log');
            const entry = document.createElement('div');
            const timestamp = new Date().toLocaleTimeString();
            const dataStr = data ? ` | Data: ${JSON.stringify(data).substring(0, 50)}...` : '';
            entry.innerText = `[${timestamp}] ${message}${dataStr}`;
            log.prepend(entry);
        }

        // 3. Initialize the Library
        window.onload = function() {
            // Check if library is loaded
            if (!window.SmartDoc || !window.SmartDoc.create) {
                document.getElementById('build-warning').style.display = 'flex';
                return;
            }

            // Example Pre-loaded Annotations from a Database
            const dbAnnotations = [
                {
                    "id": "init-1",
                    "type": "rect",
                    "x": 100, "y": 150, "width": 120, "height": 80,
                    "color": "#f87171",
                    "strokeWidth": 4,
                    "page": 1,
                    "severity": 3,
                    "reasonCode": "Rust",
                    "status": "Open",
                    "comment": "Initial Rust detected by system"
                },
                {
                    "id": "init-2",
                    "type": "text",
                    "x": 300, "y": 100,
                    "text": "Check this area",
                    "fontSize": 20,
                    "color": "#eab308",
                    "strokeWidth": 1,
                    "page": 1,
                    "status": "New"
                }
            ];

            window.SmartDoc.create('smart-doc-root', {
                // --- Configuration ---
                
                // 1. Auto-Load Document (URL)
                documentSrc: 'https://raw.githubusercontent.com/mozilla/pdf.js/ba2edeae/examples/learning/helloworld.pdf', 
                
                // 2. Pre-Load Annotations
                initialAnnotations: dbAnnotations,

                hideLoadFileBtn: false, // Show upload button
                
                // Custom Business Logic: Severity
                severityOptions: {
                    1: '#4ade80', // Green (Good)
                    2: '#facc15', // Yellow (Warning)
                    3: '#f87171', // Red (Bad)
                    4: '#7f1d1d'  // Dark Red (Critical)
                },

                // Custom Business Logic: Reason Codes
                reasonCodeOptions: [
                    'Surface Scratch', 
                    'Dent', 
                    'Paint Chip', 
                    'Rust', 
                    'Misalignment',
                    'Other'
                ],

                // Custom Business Logic: Status Workflow
                statusOptions: ['Open', 'In Review', 'Repaired', 'Rejected'],

                // Styling Override
                styleConfig: {
                    toolbar: { backgroundColor: '#111827' }
                }

            }, {
                // --- Event Callbacks ---
                onDocumentReady: () => {
                    logEvent("Document loaded and rendered successfully.");
                },
                onAnnotationsReady: () => {
                    logEvent("Initial annotations painted to canvas.");
                },
                onAnnotationAdd: (ann) => {
                    logEvent("Annotation Created", { id: ann.id, type: ann.type, reason: ann.reasonCode });
                },
                onAnnotationUpdate: (ann) => {
                    logEvent("Annotation Updated", { id: ann.id, status: ann.status, comment: ann.comment });
                },
                onAnnotationDelete: (id) => {
                    logEvent("Annotation Deleted", { id });
                },
                onClearAnnotations: () => {
                    logEvent("All annotations cleared.");
                }
            });

            logEvent("SmartDoc Library Initialized.");
        };
    </script>
</body>
</html>
